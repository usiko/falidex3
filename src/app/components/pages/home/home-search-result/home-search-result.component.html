<div class="top-container" #topContainer>
    <ion-card class="warning-card" color='secondary'>
        <ion-card-content color='secondary'>
            <ion-text>Attention le falidex n'est pas le code, c'est un outil de réstitution et de recherche, il n'est pas officiel.<br/> En cas de doute, se référer au code officiel de la ville. </ion-text>
        </ion-card-content>
    </ion-card>
    <ion-searchbar [value]="searchText" (ionChange)="search($event)" animated></ion-searchbar>
</div>
<ion-list *ngIf="(results$|async).mainResult.total>0 || (results$|async).dependenciesResult.total>0" [ngStyle]="{'height':'calc(100% - '+topContainer.offsetHeight+'px)'}">
    <ng-container *ngIf="(results$|async).mainResult.total">
        <ng-container *ngTemplateOutlet="resultTpl;context:{result:(results$|async).mainResult,title:'Meilleure(s) correspondance(s)'}"></ng-container>
    </ng-container>
    <ng-container *ngIf="(results$|async).dependenciesResult.total">
        <ng-container *ngTemplateOutlet="resultTpl;context:{result:(results$|async).dependenciesResult,title:((results$|async).mainResult.total!=0)?'J\'ai trouvé aussi: ':''}"></ng-container>
    </ng-container>

</ion-list>
<div class="no-result" *ngIf="isSearching && (results$|async).mainResult.total==0 && (results$|async).dependenciesResult.total==0">
    <p>Aucun résultat</p>
</div>

<ng-template #resultTpl let-result="result" let-title="title">
    <ng-container *ngIf="result.total>0">
        <ion-list-header *ngIf="title">
            {{title}}
        </ion-list-header>
        <ion-item-group *ngIf="result.filieres.length>0">
            <ion-list-header>
                Filières
            </ion-list-header>
            <app-filiere-block-item-list class="item" *ngFor="let item of result.filieres" [navigation]="'/filieres/detail/'" [item]="item"></app-filiere-block-item-list>
        </ion-item-group>
        <ion-item-group *ngIf="result.symbols.length>0">
            <ion-list-header>
                Insigne/Emblemes
            </ion-list-header>
            <app-block-symbol-item-list class="item" *ngFor="let item of result.symbols" [navigation]="'/symbols/detail/'" [item]="item"></app-block-symbol-item-list>
        </ion-item-group>

        <ion-item-group *ngIf="result.circulaire.length>0">
            <ion-list-header>
                Circulaires
            </ion-list-header>
            <app-block-circulaire-item-list class="item" *ngFor="let item of result.circulaire" [navigation]="'/circulaires/detail/'" [item]="item"></app-block-circulaire-item-list>
        </ion-item-group>
        <ion-item-group *ngIf="result.signification.length>0">
            <ion-list-header>
                Significations
            </ion-list-header>
            <app-signification-block-item-list class="item" *ngFor="let item of result.signification" [navigation]="'/circulaires/detail/'" [item]="item"></app-signification-block-item-list>
        </ion-item-group>

        <ion-item-group *ngIf="result.codeSpe.length>0">
            <ion-list-header>
                Spécificités
            </ion-list-header>
            <ion-item *ngFor="let item of result.codeSpe">

                <ion-label>
                    <p>{{item.name}}</p>
                </ion-label>

            </ion-item>
        </ion-item-group>
    </ng-container>
</ng-template>